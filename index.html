<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ€ã‚·ãƒ« - è‚Œã¨å¯¾è©±ã™ã‚‹æˆåˆ†åˆ†æ</title>
    <style>
        :root { 
            --primary: #76ba99; 
            --secondary: #4a90a4;
            --bg: #f8fbf9; 
            --warn: #e74c3c;
            --success: #27ae60;
            --info: #3498db;
        }
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg); 
            margin: 0; 
            padding: 15px; 
            max-width: 800px;
            margin: 0 auto;
        }
        .card { 
            background: white; 
            border-radius: 20px; 
            padding: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            margin-bottom: 15px; 
        }
        .header {
            text-align: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 20px;
            border-radius: 20px;
            margin-bottom: 20px;
        }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 1.8rem;
        }
        .header p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        /* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š */
        .profile-section {
            border-left: 4px solid var(--primary);
            padding-left: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .checkbox-item {
            background: #f0f7f3;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }
        .checkbox-item:hover {
            background: #e0f0ea;
        }
        .checkbox-item.active {
            background: var(--primary);
            color: white;
        }
        
        /* ã‚«ãƒ¡ãƒ©ãƒ»ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        #preview-container { 
            width: 100%; 
            border-radius: 15px; 
            overflow: hidden; 
            background: #eee; 
            min-height: 200px;
            position: relative;
        }
        video, #image-preview { 
            width: 100%; 
            display: block; 
        }
        #image-preview {
            display: none;
        }
        
        /* ãƒœã‚¿ãƒ³ */
        .btn-group { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin-top: 15px; 
        }
        button, .file-label { 
            background: var(--primary); 
            color: white; 
            border: none; 
            padding: 15px; 
            border-radius: 12px; 
            font-weight: bold; 
            cursor: pointer; 
            text-align: center;
            transition: all 0.3s;
            font-size: 1rem;
        }
        button:hover, .file-label:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        .file-label { 
            background: #666; 
            font-size: 0.85rem; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        
        /* AIæ´»ç”¨ãƒ­ã‚° */
        .ai-log {
            background: #f8f9fa;
            border-left: 4px solid var(--info);
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-size: 0.85rem;
        }
        .ai-log-title {
            font-weight: bold;
            color: var(--info);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .ai-log-content {
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin-top: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* çµæœè¡¨ç¤º */
        .alert-badge { 
            background: var(--warn); 
            color: white; 
            padding: 12px; 
            border-radius: 10px; 
            text-align: center; 
            font-weight: bold; 
            font-size: 0.9rem; 
            margin-bottom: 15px; 
            display: none; 
        }
        .success-badge {
            background: var(--success);
            color: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 15px;
            display: none;
        }
        
        /* ã‚¹ã‚³ã‚¢è¡¨ç¤º */
        .score-section {
            margin: 20px 0;
        }
        .score-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
            gap: 10px; 
        }
        .score-item { 
            background: linear-gradient(135deg, #f0f7f3, #e8f4f0);
            padding: 15px; 
            border-radius: 12px; 
            text-align: center;
            transition: all 0.3s;
        }
        .score-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .score-label { 
            font-size: 0.75rem; 
            color: #666; 
            margin-bottom: 5px;
        }
        .score-value { 
            font-size: 1.5rem; 
            font-weight: bold; 
            color: var(--primary); 
        }
        
        /* æˆåˆ†ãƒªã‚¹ãƒˆ */
        .ingredient-section {
            margin-top: 20px;
        }
        .category-section {
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        .category-header {
            background: linear-gradient(90deg, #f5f5f5, #fafafa);
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.3s;
            user-select: none;
        }
        .category-header:hover {
            background: linear-gradient(90deg, #eeeeee, #f5f5f5);
        }
        .category-icon {
            color: var(--primary);
            font-size: 0.8rem;
            width: 15px;
        }
        .category-name {
            flex: 1;
            font-weight: bold;
            font-size: 0.85rem;
            color: #555;
        }
        .category-count {
            font-size: 0.75rem;
            color: #999;
            background: white;
            padding: 2px 8px;
            border-radius: 10px;
        }
        .category-content {
            background: white;
        }
        .category-title { 
            background: linear-gradient(90deg, #eee, transparent);
            padding: 8px 15px; 
            border-radius: 8px; 
            font-size: 0.85rem; 
            font-weight: bold; 
            margin-top: 15px; 
            color: #555; 
        }
        .ingredient-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 12px 0; 
            border-bottom: 1px solid #f0f0f0; 
        }
        .ingredient-name { 
            font-weight: bold; 
            font-size: 0.9rem;
            flex: 1;
        }
        .ingredient-role { 
            font-size: 0.75rem; 
            color: #7f8c8d; 
            margin-top: 3px;
        }
        .ingredient-badge {
            background: #e8f5e9;
            color: #27ae60;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 10px;
        }
        .ingredient-badge.warning {
            background: #ffebee;
            color: #e74c3c;
        }
        
        /* ãƒãƒƒã‚¸ã‚¨ãƒªã‚¢ */
        .badge-area { 
            display: flex; 
            justify-content: center; 
            gap: 8px; 
            flex-wrap: wrap; 
            margin: 15px 0;
        }
        .badge { 
            background: #bdc3c7; 
            color: white; 
            padding: 6px 15px; 
            border-radius: 15px; 
            font-size: 0.75rem; 
            font-weight: bold; 
        }
        .badge.active { 
            background: #e67e22; 
        }
        .badge.eco {
            background: #27ae60;
        }
        
        /* AIåˆ†æèª¬æ˜ */
        .ai-explanation {
            background: #fff9e6;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        .ai-explanation-title {
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        .ai-explanation-text {
            font-size: 0.85rem;
            line-height: 1.6;
            color: #555;
        }
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .loading {
            text-align: center;
            padding: 20px;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
        #status {
            text-align: center;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        /* ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ */
        .tab-container {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            color: #888;
            font-weight: bold;
            font-size: 0.9rem;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
        }
        .tab.active {
            color: var(--primary);
            background: white;
            border-bottom: 3px solid var(--primary);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ */
        .ai-concierge-section {
            background: #f8fbf9;
            border-radius: 15px;
            padding: 20px;
        }
        .quick-btn {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .quick-btn:hover {
            background: var(--primary);
            color: white;
        }
        .chat-message {
            margin-bottom: 15px;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .user-message {
            text-align: right;
        }
        .user-message .message-content {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 10px 15px;
            border-radius: 15px 15px 0 15px;
            max-width: 80%;
            text-align: left;
            font-size: 0.9rem;
        }
        .assistant-message .message-content {
            display: inline-block;
            background: white;
            color: #333;
            padding: 10px 15px;
            border-radius: 15px 15px 15px 0;
            max-width: 80%;
            border: 1px solid #e0e0e0;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .thinking-message {
            color: #999;
            font-style: italic;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>

<!-- ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
<div id="onboarding-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; overflow-y: auto;">
    <div style="max-width: 600px; margin: 0 auto; padding: 40px 20px;">
        <div style="text-align: center; margin-bottom: 40px;">
            <h1 style="font-size: 2.5rem; color: var(--primary); margin-bottom: 10px;">ğŸŒ¿ ãƒãƒ€ã‚·ãƒ«</h1>
            <p style="color: #666; font-size: 1rem; line-height: 1.6;">ã‚«ãƒ¡ãƒ©ã‚’ã‹ã–ã—ã¦ã€è‚Œã¨å¯¾è©±ã™ã‚‹<br>æˆåˆ†ã‚’çŸ¥ã‚Œã°ã€ã‚¹ã‚­ãƒ³ã‚±ã‚¢ã¯ã‚‚ã£ã¨è‡ªç”±ã«ãªã‚Œã‚‹</p>
        </div>
        <div id="onboarding-content"></div>
    </div>
</div>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div class="header">
    <h1>ğŸŒ¿ ãƒãƒ€ã‚·ãƒ«</h1>
    <p>ã‚«ãƒ¡ãƒ©ã‚’ã‹ã–ã—ã¦ã€è‚Œã¨å¯¾è©±ã™ã‚‹ã€‚1ç§’ã§ã‚ã‹ã‚‹ã€ç§ã®ãŸã‚ã®æˆåˆ†è¡¨ã€‚</p>
    <p style="font-size: 0.75rem; margin-top: 5px;">Powered by Google Gemini AI</p>
</div>

<!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šã‚«ãƒ¼ãƒ‰ -->
<div class="card">
    <div class="profile-section">
        <h3 style="margin-top: 0; color: var(--primary);">ğŸ‘¤ ãƒã‚¤ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h3>
        
        <div class="form-group">
            <label>è‚Œè³ªã‚’é¸æŠ</label>
            <div class="checkbox-group" id="skin-type-group">
                <div class="checkbox-item" data-value="dry">ä¹¾ç‡¥è‚Œ</div>
                <div class="checkbox-item" data-value="oily">è„‚æ€§è‚Œ</div>
                <div class="checkbox-item" data-value="sensitive">æ•æ„Ÿè‚Œ</div>
                <div class="checkbox-item" data-value="mixed">æ··åˆè‚Œ</div>
            </div>
        </div>
        
        <div class="form-group">
            <label>é¿ã‘ãŸã„æˆåˆ†</label>
            <div class="checkbox-group" id="avoid-ingredients">
                <div class="checkbox-item" data-value="alcohol">ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«</div>
                <div class="checkbox-item" data-value="fragrance">é¦™æ–™</div>
                <div class="checkbox-item" data-value="parabens">ãƒ‘ãƒ©ãƒ™ãƒ³</div>
                <div class="checkbox-item" data-value="sulfate">ç¡«é…¸å¡©</div>
            </div>
        </div>
        
        <div class="form-group">
            <label>é‡è¦–ã™ã‚‹ä¾¡å€¤è¦³ï¼ˆæˆåˆ†ãƒ™ãƒ¼ã‚¹ï¼‰</label>
            <div class="checkbox-group" id="ethical-values">
                <div class="checkbox-item" data-value="plant-based">æ¤ç‰©ç”±æ¥æˆåˆ†é‡è¦–</div>
                <div class="checkbox-item" data-value="no-animal">å‹•ç‰©ç”±æ¥æˆåˆ†ãªã—</div>
                <div class="checkbox-item" data-value="natural">å¤©ç„¶ãƒ»è‡ªç„¶ç”±æ¥</div>
                <div class="checkbox-item" data-value="minimal">ã‚·ãƒ³ãƒ—ãƒ«å‡¦æ–¹</div>
            </div>
        </div>
    </div>
</div>

<!-- æ’®å½±ãƒ»è§£æã‚«ãƒ¼ãƒ‰ -->
<div class="card">
    <h3 style="margin-top: 0; color: var(--primary);">ğŸ“¸ æˆåˆ†è¡¨ã‚’æ’®å½±ãƒ»è§£æ</h3>
    
    <!-- Myã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆ -->
    <div id="my-items-section" style="margin-bottom: 15px; padding: 12px; background: #f0f7ff; border-radius: 10px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <label style="font-weight: bold; color: #555; font-size: 0.9rem;">
                ğŸ’¼ ä½¿ç”¨ä¸­ã®è£½å“ï¼ˆä½µç”¨ãƒã‚§ãƒƒã‚¯ï¼‰
            </label>
            <button onclick="openMyItemsManager()" style="background: var(--info); color: white; border: none; padding: 6px 12px; border-radius: 15px; font-size: 0.75rem; cursor: pointer;">
                ç®¡ç†
            </button>
        </div>
        <div id="my-items-list" style="font-size: 0.85rem; color: #666;">
            ç™»éŒ²ãªã—
        </div>
    </div>
    
    <!-- ä¿å­˜æ¸ˆã¿è£½å“æ¤œç´¢ -->
    <div id="saved-products-section" style="margin-bottom: 15px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <label style="font-weight: bold; color: #555; font-size: 0.9rem;">
                ğŸ’¾ ä¿å­˜æ¸ˆã¿è£½å“
            </label>
            <button onclick="openProductManager()" style="background: var(--secondary); color: white; border: none; padding: 6px 12px; border-radius: 15px; font-size: 0.75rem; cursor: pointer;">
                ğŸ“‹ ç®¡ç†
            </button>
        </div>
        
        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
            <select id="saved-product-select" onchange="loadSavedProduct()" style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.9rem;">
                <option value="">-- æ–°ã—ãæ’®å½±ã™ã‚‹ --</option>
            </select>
        </div>
        
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <select id="sort-order" onchange="loadSavedProductsList()" style="padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.8rem;">
                <option value="newest">æ–°ã—ã„é †</option>
                <option value="oldest">å¤ã„é †</option>
                <option value="name">åå‰é †</option>
                <option value="brand">ãƒ–ãƒ©ãƒ³ãƒ‰é †</option>
                <option value="favorite">ãŠæ°—ã«å…¥ã‚Š</option>
            </select>
            
            <input type="text" id="search-products" placeholder="ğŸ” æ¤œç´¢..." onkeyup="filterProducts()" 
                style="flex: 1; padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.8rem;">
        </div>
    </div>
    
    <div style="text-align: center; color: #999; font-size: 0.85rem; margin: 10px 0;">ã¾ãŸã¯</div>
    
    <div id="status">æº–å‚™å®Œäº†</div>
    <div id="preview-container">
        <video id="video" autoplay playsinline></video>
        <img id="image-preview">
    </div>
    <div class="btn-group">
        <button id="capture-btn" onclick="captureAndAnalyze()">ğŸ“· æ’®å½±ã—ã¦è§£æ</button>
        <label class="file-label">
            ğŸ“ ç”»åƒã‚’é¸æŠ
            <input type="file" id="file-input" accept="image/*" onchange="loadImageFile(event)" style="display:none;">
        </label>
    </div>
    <button id="reset-btn" onclick="resetCamera()" style="display:none; width:100%; margin-top:10px; background:#95a5a6;">ğŸ”„ ã‚«ãƒ¡ãƒ©ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<!-- çµæœè¡¨ç¤ºã‚«ãƒ¼ãƒ‰ -->
<div id="result-area" class="card" style="display:none;">
    <!-- ã‚¿ãƒ– -->
    <div class="tab-container">
        <button class="tab active" onclick="switchTab('analysis')">ğŸ“Š åˆ†æçµæœ</button>
        <button class="tab" onclick="switchTab('ai-log')">ğŸ¤– AIæ´»ç”¨ãƒ­ã‚°</button>
    </div>
    
    <!-- åˆ†æçµæœã‚¿ãƒ– -->
    <div id="tab-analysis" class="tab-content active">
        <!-- ä½µç”¨æ³¨æ„ã‚¢ãƒ©ãƒ¼ãƒˆ -->
        <div id="compatibility-alert" style="display: none; background: linear-gradient(135deg, #fff3e0, #ffe0b2); border-left: 4px solid #ff9800; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
            <div style="font-weight: bold; color: #e65100; margin-bottom: 8px;">âš ï¸ ä½µç”¨æ³¨æ„</div>
            <div id="compatibility-details" style="font-size: 0.9rem; line-height: 1.6;"></div>
        </div>
        
        <!-- è£½å“åä¿å­˜ã‚¨ãƒªã‚¢ -->
        <div id="save-product-area" style="background: #f0f7f3; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
            <label style="display: block; font-weight: bold; color: #555; margin-bottom: 8px; font-size: 0.9rem;">
                ğŸ’¾ ã“ã®è£½å“ã‚’ä¿å­˜
            </label>
            <input type="text" id="product-name-input" placeholder="è£½å“åï¼ˆä¾‹ï¼šâ—‹â—‹ç¾å®¹æ¶²ï¼‰" 
                style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 8px; font-size: 0.9rem;">
            <input type="text" id="brand-name-input" placeholder="ãƒ–ãƒ©ãƒ³ãƒ‰åï¼ˆä»»æ„ï¼‰" 
                style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 8px; font-size: 0.9rem;">
            
            <!-- ãƒ¡ãƒ¢æ©Ÿèƒ½ -->
            <textarea id="product-memo-input" placeholder="ğŸ“ ãƒ¡ãƒ¢ï¼ˆä½¿ç”¨æ„Ÿã€è³¼å…¥å ´æ‰€ãªã©ï¼‰" 
                style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 8px; font-size: 0.9rem; resize: vertical; min-height: 60px;"></textarea>
            
            <!-- å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
            <div style="margin-bottom: 8px;">
                <label class="file-label" style="display: inline-block; width: 100%; text-align: center; padding: 10px; background: #f5f5f5; cursor: pointer;">
                    ğŸ“· è£½å“å†™çœŸã‚’è¿½åŠ ï¼ˆä»»æ„ï¼‰
                    <input type="file" id="product-photo-input" accept="image/*" style="display: none;" onchange="previewProductPhoto(event)">
                </label>
                <div id="photo-preview" style="margin-top: 8px; display: none;">
                    <img id="photo-preview-img" style="width: 100%; max-height: 150px; object-fit: contain; border-radius: 8px;">
                </div>
            </div>
            
            <button onclick="saveProduct()" style="width: 100%; background: var(--success); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 8px;">
                ğŸ’¾ ä¿å­˜ã™ã‚‹
            </button>
            <button onclick="saveAndAddToMyItems()" style="width: 100%; background: var(--info); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                ğŸ’¾ ä¿å­˜ + ä½¿ç”¨ä¸­è£½å“ã«è¿½åŠ 
            </button>
            <div id="save-message" style="margin-top: 8px; text-align: center; font-size: 0.85rem; color: var(--success); display: none;">
                âœ… ä¿å­˜ã—ã¾ã—ãŸï¼
            </div>
        </div>
        
        <!-- ç·åˆé©åˆåº¦ï¼ˆæœ€å„ªå…ˆè¡¨ç¤ºï¼‰ -->
        <div id="overall-match" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center; display: none;">
            <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 5px;">ã‚ãªãŸã¸ã®ç·åˆé©åˆåº¦</div>
            <div id="match-score" style="font-size: 3rem; font-weight: bold; margin: 10px 0;">--%</div>
            <div id="match-reason" style="font-size: 0.85rem; line-height: 1.6; opacity: 0.95;"></div>
        </div>
        
        <div id="allergy-alert" class="alert-badge">âš ï¸ æ³¨æ„ãŒå¿…è¦ãªæˆåˆ†ãŒå«ã¾ã‚Œã¦ã„ã¾ã™</div>
        <div id="success-alert" class="success-badge">âœ… ã‚ãªãŸã®è‚Œè³ªã«é©ã—ãŸè£½å“ã§ã™</div>
        
        <div class="badge-area" id="badge-area">
            <div class="badge active" style="background:var(--info)">ğŸ¤– AIåˆ†æå®Œäº†</div>
        </div>
        
        <!-- AIã«ã‚ˆã‚‹ç·åˆè©•ä¾¡ -->
        <div class="ai-explanation">
            <div class="ai-explanation-title">ğŸ¤– AIã«ã‚ˆã‚‹ç·åˆè©•ä¾¡</div>
            <div class="ai-explanation-text" id="ai-summary">åˆ†æä¸­...</div>
        </div>
        
        <!-- è‚Œè³ªåˆ¥ã‚¹ã‚³ã‚¢ -->
        <div class="score-section">
            <h4 style="font-size: 0.95rem; color: #666; margin-bottom: 15px;">è‚Œè³ªåˆ¥é©åˆã‚¹ã‚³ã‚¢</h4>
            <div class="score-grid" id="score-grid"></div>
        </div>
        
        <!-- æˆåˆ†ãƒªã‚¹ãƒˆ -->
        <div class="ingredient-section">
            <h4 style="font-size: 0.95rem; color: #666;">æ¤œå‡ºã•ã‚ŒãŸæˆåˆ†</h4>
            <div id="ingredient-list"></div>
        </div>
        
        <!-- AIã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ -->
        <div class="ai-concierge-section" style="margin-top: 30px; border-top: 2px solid #e0e0e0; padding-top: 20px;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                <h4 style="font-size: 1rem; color: var(--primary); margin: 0;">ğŸ¤– AIã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ã«ç›¸è«‡</h4>
                <button onclick="toggleChat()" id="chat-toggle-btn" style="background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 20px; font-size: 0.8rem; cursor: pointer;">
                    ğŸ’¬ é–‹ã
                </button>
            </div>
            
            <div id="chat-container" style="display: none;">
                <!-- ã‚¯ã‚¤ãƒƒã‚¯è³ªå•ãƒœã‚¿ãƒ³ -->
                <div class="quick-questions" style="margin-bottom: 15px;">
                    <div style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">ã‚ˆãã‚ã‚‹è³ªå•</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <button class="quick-btn" onclick="askQuickQuestion('ã“ã®è£½å“ã¯ç§ã®è‚Œè³ªã«åˆã£ã¦ã„ã¾ã™ã‹ï¼Ÿ')">ç§ã®è‚Œã«åˆã†ï¼Ÿ</button>
                        <button class="quick-btn" onclick="askQuickQuestion('æœä½¿ã£ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿæ—¥ä¸­ã®UVã‚±ã‚¢ã¯å¿…è¦ã§ã™ã‹ï¼Ÿ')">æœä½¿ãˆã‚‹ï¼Ÿ</button>
                        <button class="quick-btn" onclick="askQuickQuestion('ã©ã®æˆåˆ†ãŒä¿æ¹¿ã«åŠ¹æœçš„ã§ã™ã‹ï¼Ÿ')">ä¿æ¹¿æˆåˆ†ã¯ï¼Ÿ</button>
                        <button class="quick-btn" onclick="askQuickQuestion('æ•æ„Ÿè‚Œã§ã‚‚æ¯æ—¥ä½¿ãˆã¾ã™ã‹ï¼Ÿ')">æ¯æ—¥ä½¿ãˆã‚‹ï¼Ÿ</button>
                        <button class="quick-btn" onclick="askQuickQuestion('æ³¨æ„ãŒå¿…è¦ãªæˆåˆ†ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ')">æ³¨æ„æˆåˆ†ã¯ï¼Ÿ</button>
                        <button class="quick-btn" onclick="askQuickQuestion('ãƒ“ã‚¿ãƒŸãƒ³Cç¾å®¹æ¶²ã¨ä½µç”¨ã—ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿ')">ä½µç”¨OKï¼Ÿ</button>
                    </div>
                </div>
                
                <!-- ãƒãƒ£ãƒƒãƒˆå±¥æ­´ -->
                <div id="chat-messages" style="background: #f9f9f9; border-radius: 10px; padding: 15px; max-height: 400px; overflow-y: auto; margin-bottom: 15px;">
                    <div class="chat-message assistant-message">
                        <div class="message-content">
                            ã“ã‚“ã«ã¡ã¯ï¼ã“ã®è£½å“ã®æˆåˆ†ã«ã¤ã„ã¦ã€ä½•ã§ã‚‚ãŠèããã ã•ã„ã€‚<br>
                            <strong>ç§ãŒç­”ãˆã‚‰ã‚Œã‚‹ã“ã¨</strong>ï¼š<br>
                            â€¢ ã“ã®è£½å“ã«å«ã¾ã‚Œã‚‹æˆåˆ†ã®åŠ¹æœã‚„å®‰å…¨æ€§<br>
                            â€¢ ã‚ãªãŸã®è‚Œè³ªã¨ã®ç›¸æ€§<br>
                            â€¢ ä½¿ã„æ–¹ã‚„ä½µç”¨ã«é–¢ã™ã‚‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹<br>
                            <br>
                            <strong>ç­”ãˆã‚‰ã‚Œãªã„ã“ã¨</strong>ï¼š<br>
                            â€¢ æˆåˆ†è¡¨ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãªã„é…åˆæ¿ƒåº¦<br>
                            â€¢ è£½é€ å·¥ç¨‹ã®è©³ç´°<br>
                            â†’ ã“ã‚Œã‚‰ã¯ãƒ¡ãƒ¼ã‚«ãƒ¼ã¸ãŠå•ã„åˆã‚ã›ãã ã•ã„
                        </div>
                    </div>
                </div>
                
                <!-- å…¥åŠ›æ¬„ -->
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chat-input" placeholder="ä¾‹ï¼šã“ã®ç¾å®¹æ¶²ã€å¤œã ã‘ä½¿ã†ã¹ãï¼Ÿ" 
                        style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.9rem;"
                        onkeypress="if(event.key==='Enter') sendChatMessage()">
                    <button onclick="sendChatMessage()" id="chat-send-btn"
                        style="background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; white-space: nowrap;">
                        é€ä¿¡
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AIæ´»ç”¨ãƒ­ã‚°ã‚¿ãƒ– -->
    <div id="tab-ai-log" class="tab-content">
        <div class="ai-log">
            <div class="ai-log-title">
                ğŸ” ä½¿ç”¨ã—ãŸAI: Google Gemini Pro Vision
            </div>
            <p style="margin: 10px 0; font-size: 0.85rem;">ç”»åƒã‹ã‚‰æˆåˆ†ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹ãŸã‚ã«ä½¿ç”¨</p>
        </div>
        
        <div class="ai-log">
            <div class="ai-log-title">
                ğŸ“ OCRãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            </div>
            <div class="ai-log-content" id="ocr-prompt-log">-</div>
        </div>
        
        <div class="ai-log">
            <div class="ai-log-title">
                ğŸ§ª æˆåˆ†åˆ†æãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            </div>
            <div class="ai-log-content" id="analysis-prompt-log">-</div>
        </div>
        
        <div class="ai-log">
            <div class="ai-log-title">
                ğŸ’¡ AIæ´»ç”¨ã®å·¥å¤«ãƒã‚¤ãƒ³ãƒˆ
            </div>
            <ul style="margin: 10px 0; padding-left: 20px; font-size: 0.85rem;">
                <li>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ§‹é€ åŒ–ã—ã¦AIã«æ¸¡ã™ã“ã¨ã§å€‹åˆ¥åŒ–ã•ã‚ŒãŸåˆ†æã‚’å®Ÿç¾</li>
                <li>2æ®µéšAIå‡¦ç†: Vision APIã§æˆåˆ†æŠ½å‡º â†’ ãƒ†ã‚­ã‚¹ãƒˆAPIã§è©³ç´°åˆ†æ</li>
                <li>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº: äº‹å‰å®šç¾©ã•ã‚ŒãŸ100ç¨®é¡ã®æˆåˆ†DBã¨AIåˆ¤å®šã‚’çµ„ã¿åˆã‚ã›</li>
                <li>æ¤œè¨¼ãƒ—ãƒ­ã‚»ã‚¹: AIã®å›ç­”ã‚’è¤‡æ•°ã®è¦³ç‚¹ï¼ˆå®‰å…¨æ€§ãƒ»åŠ¹æœãƒ»ç’°å¢ƒé…æ…®ï¼‰ã§ã‚¯ãƒ­ã‚¹ãƒã‚§ãƒƒã‚¯</li>
            </ul>
        </div>
        
        <div class="ai-log">
            <div class="ai-log-title">
                ğŸ§® ç·åˆé©åˆåº¦ã®è¨ˆç®—éç¨‹ï¼ˆæ¤œè¨¼ç”¨ï¼‰
            </div>
            <p style="margin: 10px 0; font-size: 0.85rem; color: #666;">
                <strong>è¨ˆç®—æ–¹æ³•</strong>: Gemini Text APIã«ã‚ˆã‚‹AIåˆ¤å®š<br>
                <strong>å…¥åŠ›</strong>: æ¤œå‡ºã•ã‚ŒãŸæˆåˆ† + ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«<br>
                <strong>å‡ºåŠ›</strong>: é©åˆåº¦(0-100%) + ç†ç”± + è©³ç´°è©•ä¾¡
            </p>
            <div class="ai-log-content" id="match-calculation-log">
                <div style="color: #999;">æˆåˆ†è¡¨ã‚’è§£æã™ã‚‹ã¨ã€ã“ã“ã«è¨ˆç®—éç¨‹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
            </div>
        </div>
        
        <div class="ai-log">
            <div class="ai-log-title">
                ğŸ“Š è‚Œåˆ¥é©åˆã‚¹ã‚³ã‚¢ã®è¨ˆç®—éç¨‹ï¼ˆæ¤œè¨¼ç”¨ï¼‰
            </div>
            <p style="margin: 10px 0; font-size: 0.85rem; color: #666;">
                <strong>è¨ˆç®—æ–¹æ³•</strong>: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç…§åˆ + å›ºå®šã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°å¼<br>
                <strong>è¨ˆç®—å¼</strong>: <code>åŸºæº–ç‚¹50 + (goodForæˆåˆ† Ã— 12ç‚¹) - (badForæˆåˆ† Ã— 18ç‚¹)</code><br>
                <strong>ç¯„å›²</strong>: 0-100ç‚¹ï¼ˆä¸Šé™ãƒ»ä¸‹é™ã§ã‚¯ãƒªãƒƒãƒ—ï¼‰
            </p>
            <div class="ai-log-content" id="score-calculation-log">
                <div style="color: #999;">æˆåˆ†è¡¨ã‚’è§£æã™ã‚‹ã¨ã€ã“ã“ã«è¨ˆç®—éç¨‹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
            </div>
        </div>
        
        <div class="ai-log">
            <div class="ai-log-title">
                ğŸ“‹ æ¤œè¨¼ç”¨ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›
            </div>
            <p style="margin: 10px 0; font-size: 0.85rem;">
                æ¤œè¨¼ã‚·ãƒ¼ãƒˆã«è¨˜éŒ²ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼
            </p>
            <button onclick="copyVerificationData()" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px;">
                ğŸ“‹ æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼
            </button>
            <div class="ai-log-content" id="verification-data-output">
                <div style="color: #999;">ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
            </div>
        </div>
    </div>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<!-- è£½å“ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="product-manager-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
    <div style="max-width: 600px; margin: 50px auto; background: white; border-radius: 20px; padding: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: var(--primary);">ğŸ“‹ è£½å“ç®¡ç†</h3>
            <button onclick="closeProductManager()" style="background: #ccc; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer;">âœ• é–‰ã˜ã‚‹</button>
        </div>
        
        <div style="margin-bottom: 15px; display: flex; gap: 10px;">
            <button onclick="exportToCSV()" style="flex: 1; background: var(--info); color: white; border: none; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                ğŸ“¥ CSVå‡ºåŠ›
            </button>
            <button onclick="importFromCSV()" style="flex: 1; background: var(--secondary); color: white; border: none; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                ğŸ“¤ CSVå–è¾¼
            </button>
        </div>
        
        <div id="product-list-container"></div>
    </div>
</div>

<input type="file" id="csv-import-input" accept=".csv" style="display: none;" onchange="handleCSVImport(event)">

<script src="database.js"></script>
<script src="app_full.js"></script>
<script src="onboarding.js"></script>

</body>
</html>
